<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>わどのさいと</title>
  <link rel="icon" href="assets/miku.jpg" type="image/jpeg">
  <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <main class="page">
      <section class="hero">
        <div class="slide-card" id="slideCard">
          <div class="card-content">
            <h1 class="title">にゃんこ代行メニュー</h1>
            <p class="subtitle">各アイテム 50円 / 選び放題 300円</p>

            <div class="items-grid">
              <ul>
                <li>猫缶</li>
                <li>XP</li>
                <li>NP</li>
                <li>敵城</li>
                <li>自城</li>
                <li>銀チケ</li>
                <li>金チケ</li>
                <li>プラチケ</li>
                <li>レジェチケ</li>
              </ul>

              <ul>
                <li>全キャラ開放</li>
                <li>全キャラレベルマ</li>
                <li>全キャラ第三形態</li>
                <li>全ステ解放</li>
                <li>お宝（銅・銀・金）</li>
                <li>クリア回数</li>
                <li>バトルアイテム</li>
                <li>キャッツアイ</li>
                <li>マタタビ</li>
              </ul>

              <ul>
                <li>猫ビタン</li>
                <li>城素材</li>
                <li>リーダーシップ</li>
                <li>広告削除</li>
                <li>施設レベル</li>
                <li>指定キャラ</li>
                <li class="price">各50円</li>
                <li class="bundle">選び放題 300円</li>
              </ul>
            </div>

            <div class="cta">
              <a class="primary" href="https://x.com/w6d0da" target="_blank" rel="noopener">注文はこちら</a>
            </div>
          </div>

          <div class="card-media">
            <!-- GIF を assets/miku.gif に置いてください -->
            <img src="assets/miku.gif" alt="みく.gif" class="miku" onerror="this.style.opacity=0.5;">
          </div>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="left">
        <div class="badge">X_ID: <strong>w6doda</strong></div>
        <div class="badge">Discord_ID: <strong>w6do</strong></div>
      </div>
      <div class="right">
        <a class="server" href="https://discord.gg/sG6NrK5z7s" target="_blank" rel="noopener">Discord サーバー参加</a>
      </div>
    </footer>

    <script src="script.js"></script>

<audio id="bgm" autoplay muted preload="auto"></audio>

<script>
  // ✅ 曲リスト（GitHub raw）
  const tracks = [
    "https://github.com/w6d0/wado/raw/refs/heads/main/music/1_Tube.mov",
    "https://github.com/w6d0/wado/raw/refs/heads/main/music/2_Tube.mov",
    "https://github.com/w6d0/wado/raw/refs/heads/main/music/3_Tube.mov",
    "https://github.com/w6d0/wado/raw/refs/heads/main/music/5_Tube.mov"
  ];

  const bgm = document.getElementById("bgm");
  let current = 0;
  let fading = false;
  let fadeInterval = null;
  let userInteracted = false;

  // 初期設定（ブラウザ制限対策）
  bgm.volume = 0;
  bgm.muted = true;

  // 🎧 再生関数
  function playTrack(index) {
    const src = tracks[index];
    bgm.src = src;

    bgm.play().then(() => {
      console.log(`🎵 再生開始: ${src}`);
      // 再生成功 → 少し遅れて音を戻す（Chrome対策）
      setTimeout(() => {
        bgm.muted = false;
        fadeIn(bgm, 0.1, 2000);
      }, 1000);
    }).catch(err => {
      console.warn("⚠️ 自動再生がブロックされました:", err);
      if (!userInteracted) {
        console.log("💡 ページをクリック・スクロールなどするとBGMが再生されます。");
      }
    });
  }

  // 🎚️ フェードイン
  function fadeIn(audio, targetVolume, duration) {
    if (fading) return;
    fading = true;
    let step = (targetVolume - audio.volume) / (duration / 100);
    fadeInterval = setInterval(() => {
      if (audio.volume < targetVolume) {
        audio.volume = Math.min(audio.volume + step, targetVolume);
      } else {
        clearInterval(fadeInterval);
        fading = false;
      }
    }, 100);
  }

  // 🎚️ フェードアウト
  function fadeOut(audio, duration, callback) {
    if (fading) return;
    fading = true;
    let step = audio.volume / (duration / 100);
    fadeInterval = setInterval(() => {
      if (audio.volume > 0) {
        audio.volume = Math.max(audio.volume - step, 0);
      } else {
        clearInterval(fadeInterval);
        fading = false;
        if (callback) callback();
      }
    }, 100);
  }

  // 🎶 曲が終わったら次へ
  bgm.addEventListener("ended", () => {
    fadeOut(bgm, 1500, () => {
      current = (current + 1) % tracks.length;
      playTrack(current);
    });
  });

  // 🚀 初回ロード後に試す
  window.addEventListener("load", () => {
    setTimeout(() => playTrack(current), 500);
  });

  // 🖱️🧭🖱️ ユーザー操作（クリック・スクロール・キー押下・マウス移動・タップ）で再試行
  function unlockPlayback() {
    if (!userInteracted) {
      userInteracted = true;
      console.log("🟢 ユーザー操作検知 → 自動再生再試行");
      playTrack(current);
    }
  }

  ["click", "mousemove", "scroll", "touchstart", "keydown"].forEach(event => {
    document.addEventListener(event, unlockPlayback, { once: true });
  });
</script>


  </body>
</html>
